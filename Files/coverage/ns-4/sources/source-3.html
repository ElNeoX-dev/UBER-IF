


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TSP1</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.malveillance.uberif.model.algo</a>
</div>

<h1>Coverage Summary for Class: TSP1 (com.malveillance.uberif.model.algo)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TSP1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/53)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.malveillance.uberif.model.algo;
&nbsp;
&nbsp;import com.malveillance.uberif.model.CityMap;
&nbsp;import com.malveillance.uberif.model.Delivery;
&nbsp;import com.malveillance.uberif.model.TimeWindow;
&nbsp;
&nbsp;import java.util.*;
&nbsp;
<b class="nc">&nbsp;public class TSP1 extends TemplateTSP {</b>
&nbsp;	@Override
&nbsp;	protected int bound(Delivery currentVertex, Collection&lt;Delivery&gt; unvisited) {
<b class="nc">&nbsp;		if (unvisited.isEmpty()) {</b>
<b class="nc">&nbsp;			return 0;</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		double bound = CityMap.INFINITE_LENGTH;</b>
<b class="nc">&nbsp;		for (Delivery v : unvisited) {</b>
<b class="nc">&nbsp;			double distance = g.getDistance(currentVertex.getIntersection(), v.getIntersection());</b>
<b class="nc">&nbsp;			if (distance &lt; bound) {</b>
<b class="nc">&nbsp;				bound = distance;</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		for (Delivery v1 : unvisited) {</b>
<b class="nc">&nbsp;			double nearestNeighborDistance = CityMap.INFINITE_LENGTH;</b>
<b class="nc">&nbsp;			for (Delivery v2 : unvisited) {</b>
<b class="nc">&nbsp;				if (!v1.equals(v2)) {</b>
<b class="nc">&nbsp;					double distance = g.getDistance(v1.getIntersection(), v2.getIntersection());</b>
<b class="nc">&nbsp;					if (distance &lt; nearestNeighborDistance) {</b>
<b class="nc">&nbsp;						nearestNeighborDistance = distance;</b>
&nbsp;					}
&nbsp;				}
<b class="nc">&nbsp;			}</b>
<b class="nc">&nbsp;			if (nearestNeighborDistance &lt; CityMap.INFINITE_LENGTH) {</b>
<b class="nc">&nbsp;				bound += nearestNeighborDistance;</b>
&nbsp;			}
<b class="nc">&nbsp;		}</b>
&nbsp;
<b class="nc">&nbsp;		return (int)Math.ceil(bound);</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	protected Iterator&lt;Delivery&gt; iterator(Delivery currentVertex, Collection&lt;Delivery&gt; unvisited, CityMap g, double currentTime) {
<b class="nc">&nbsp;		List&lt;Delivery&gt; sortedUnvisited = new ArrayList&lt;&gt;(unvisited);</b>
<b class="nc">&nbsp;		sortedUnvisited.sort((d1, d2) -&gt; {</b>
<b class="nc">&nbsp;			double distanceToD1 = g.getDistance(currentVertex.getIntersection(), d1.getIntersection());</b>
<b class="nc">&nbsp;			double distanceToD2 = g.getDistance(currentVertex.getIntersection(), d2.getIntersection());</b>
&nbsp;
<b class="nc">&nbsp;			double arrivalTimeToD1 = currentTime + distanceToD1;</b>
<b class="nc">&nbsp;			double arrivalTimeToD2 = currentTime + distanceToD2;</b>
&nbsp;
<b class="nc">&nbsp;			int timeWindowComparison = compareTimeWindows(arrivalTimeToD1, d1.getTimeWindow(), arrivalTimeToD2, d2.getTimeWindow());</b>
<b class="nc">&nbsp;			if (timeWindowComparison != 0) {</b>
<b class="nc">&nbsp;				return timeWindowComparison;</b>
&nbsp;			}
<b class="nc">&nbsp;			return Double.compare(distanceToD1, distanceToD2);</b>
&nbsp;		});
&nbsp;
<b class="nc">&nbsp;		return new SeqIter(sortedUnvisited, currentVertex, g);</b>
&nbsp;	}
&nbsp;
&nbsp;	private int compareTimeWindows(double arrivalTime1, TimeWindow tw1, double arrivalTime2, TimeWindow tw2) {
<b class="nc">&nbsp;		double tw1Start = convertToSecondsPastHour(8,tw1.getStartingTime());</b>
<b class="nc">&nbsp;		double tw1End = convertToSecondsPastHour(8,tw1.getEndingTime());</b>
<b class="nc">&nbsp;		double tw2Start = convertToSecondsPastHour(8,tw2.getStartingTime());</b>
<b class="nc">&nbsp;		double tw2End = convertToSecondsPastHour(8,tw2.getEndingTime());</b>
&nbsp;
<b class="nc">&nbsp;		boolean isInWindow1 = arrivalTime1 &gt;= tw1Start &amp;&amp; arrivalTime1 &lt;= tw1End;</b>
<b class="nc">&nbsp;		boolean isInWindow2 = arrivalTime2 &gt;= tw2Start &amp;&amp; arrivalTime2 &lt;= tw2End;</b>
&nbsp;
<b class="nc">&nbsp;		if (isInWindow1 &amp;&amp; isInWindow2) {</b>
<b class="nc">&nbsp;			return Double.compare(tw1End, tw2End);</b>
&nbsp;		}
<b class="nc">&nbsp;		if (isInWindow1) {</b>
<b class="nc">&nbsp;			return -1;</b>
&nbsp;		}
<b class="nc">&nbsp;		if (isInWindow2) {</b>
<b class="nc">&nbsp;			return 1;</b>
&nbsp;		}
<b class="nc">&nbsp;		if (arrivalTime1 &lt; tw1Start &amp;&amp; arrivalTime2 &lt; tw2Start) {</b>
<b class="nc">&nbsp;			return Double.compare(tw1Start, tw2Start);</b>
&nbsp;		}
<b class="nc">&nbsp;		return Double.compare(tw2End, tw1End);</b>
&nbsp;	}
&nbsp;
&nbsp;	private double convertToSecondsPastHour(int hour,Date time) {
<b class="nc">&nbsp;		Calendar calendar = Calendar.getInstance();</b>
<b class="nc">&nbsp;		calendar.setTime(time);</b>
<b class="nc">&nbsp;		int hours = calendar.get(Calendar.HOUR_OF_DAY);</b>
<b class="nc">&nbsp;		int minutes = calendar.get(Calendar.MINUTE);</b>
<b class="nc">&nbsp;		int seconds = calendar.get(Calendar.SECOND);</b>
<b class="nc">&nbsp;		return (hours - hour) * 3600 + minutes * 60 + seconds;</b>
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-12-22 22:18</div>
</div>
</body>
</html>
